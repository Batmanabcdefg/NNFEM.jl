<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Solvers · NNFEM</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="NNFEM logo"/></a><div class="docs-package-name"><span class="docs-autofit">NNFEM</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Getting Started</a></li><li><span class="tocitem">Examples: Inverse Problems</span><ul><li><a class="tocitem" href="../verify/">Dynamic Problems</a></li><li><a class="tocitem" href="../verify_linear/">Linear Elasticity</a></li><li><a class="tocitem" href="../hyperelasticity/">Hyperelasticity</a></li><li><a class="tocitem" href="../verify_function/">Helper Functions</a></li></ul></li><li><span class="tocitem">Examples: Forward Computation</span><ul><li><a class="tocitem" href="../ex_simulation/">Simulaton Code Structure</a></li><li><a class="tocitem" href="../ex_ad/">Automatic Differentiation</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../representation/">Representations of Constitutive Relation</a></li><li class="is-active"><a class="tocitem" href>Solvers</a><ul class="internal"><li><a class="tocitem" href="#AD-free-Solvers-1"><span>AD-free Solvers</span></a></li><li><a class="tocitem" href="#AD-capable-Solvers-1"><span>AD-capable Solvers</span></a></li></ul></li><li><a class="tocitem" href="../gmsh/">Creating Mesh for FEM</a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Solvers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Solvers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kailaix/NNFEM.jl/blob/master/docs/src/solvers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Solvers-1"><a class="docs-heading-anchor" href="#Solvers-1">Solvers</a><a class="docs-heading-anchor-permalink" href="#Solvers-1" title="Permalink"></a></h1><p>There are two types of solvers: <strong>AD-free</strong> solvers, which does not support automatic differentiation but in general more efficient due to less bookkeeping; and <strong>AD-capable</strong> solvers, which has automatic differentiation so you can use them to solve inverse problems.</p><h2 id="AD-free-Solvers-1"><a class="docs-heading-anchor" href="#AD-free-Solvers-1">AD-free Solvers</a><a class="docs-heading-anchor-permalink" href="#AD-free-Solvers-1" title="Permalink"></a></h2><p>AD-free solvers are located in <code>src/fem/solvers/Solver.jl</code> and <code>src/fem/solver/SolverV2.jl</code>. These solvers are implemented in pure Julia. </p><ul><li><a href="@ref"><code>LinearStaticSolver</code></a></li></ul><p>Consider a static linear elasticity problem </p><div>\[\begin{aligned}
\text{div}\sigma &amp;= f &amp; (x,y) \in \Omega\\ 
\sigma &amp;= H\epsilon \\ 
u(x,y) &amp;= u_0(x,y) &amp; (x,y) \in \partial \Omega
\end{aligned}\]</div><p>on a unit square domain <span>$\Omega$</span>. We can compare the result with PoreFlow.jl. </p><pre><code class="language-julia" id="-------------------------------------------------">#  generate MMS using the following code
# using SymPy
# x, y = @vars x y
# u = x*y*(1-y)
# v = x*(1-y)

# ux = diff(u, x)
# uy = diff(u, y)
# vx = diff(v, x)
# vy = diff(v, y)

# ε = [
#     ux
#     vy
#     uy + vx 
# ]

# H = domain.elements[1].mat[1].H
# σ = H*ε

# f1 = diff(σ[1], x) + diff(σ[3], y)
# f2 = diff(σ[3], x) + diff(σ[2], y)


using NNFEM
using PoreFlow
using PyPlot 

m = 40
n = 40
h = 1/m
domain = example_domain(m, n, h)
x, y = domain.nodes[:,1], domain.nodes[:,2]
out = [@. x*y*(1-y)
      @. x*(1-y)]


EBC = zeros(Int64,domain.nnodes, 2)
g = [(@. x*y*(1-y)) (@. x*(1-y))]
FBC = zeros(Int64,domain.nnodes,2)
f = zeros(domain.nnodes,2)

for j = 1:n+1
    EBC[(j-1)*(m+1)+m+1, :] .= -1
    EBC[(j-1)*(m+1)+1, :] .= -1
end

for i = 1:m+1
    EBC[n*(m+1)+i, :] .= -1
    EBC[i, :] .= -1
end

nodes, elements = domain.nodes, domain.elements

domain = Domain(nodes, elements, 2, EBC, g, FBC, f)
H = domain.elements[1].mat[1].H

EBC_func = nothing 
FBC_func = nothing 

function body_func(x, y, t)
    f1 = @. -1.48148148148148x - 2.46913580246914
    f2 = @. 2.46913580246914 - 4.93827160493827y
    -[f1 f2]
end
globaldata = GlobalData(missing, missing, missing, missing, domain.neqs, EBC_func, FBC_func, body_func)

#-------------------------------------------------
# PoreFlow Solver
@info &quot;Solving using PoreFlow...&quot;
bd = bcnode(&quot;all&quot;, m, n, h)
K = compute_fem_stiffness_matrix(H, m, n, h)
K, Kbd = fem_impose_Dirichlet_boundary_condition(K, bd, m, n, h)
ff = Kbd * domain.state[[bd; bd.+domain.nnodes]]

F1 = eval_f_on_gauss_pts((x,y)-&gt;-1.48148148148148x - 2.46913580246914, m, n, h)
F2 = eval_f_on_gauss_pts((x,y)-&gt; 2.46913580246914 - 4.93827160493827y, m, n, h)
F = compute_fem_source_term(-F1, -F2, m, n, h)

rhs = F - ff
rhs[[bd; bd.+domain.nnodes]] = out[[bd; bd.+domain.nnodes]]
out2 = K\rhs
figure(figsize=(10,10))
title(&quot;PoreFlow&quot;)
subplot(221)
visualize_scalar_on_scoped_body(out2[1:domain.nnodes], zeros(size(domain.state)...), domain)
subplot(222)
visualize_scalar_on_scoped_body(out[1:domain.nnodes], zeros(size(domain.state)...), domain)

subplot(223)
visualize_scalar_on_scoped_body(out2[domain.nnodes+1:end], zeros(size(domain.state)...), domain)
subplot(224)
visualize_scalar_on_scoped_body(out[domain.nnodes+1:end], zeros(size(domain.state)...), domain)

#-------------------------------------------------
# NNFEM Solver
@info &quot;Solving using NNFEM...&quot;
globaldata, domain = LinearStaticSolver(globaldata, domain)
figure(figsize=(10,10))
title(&quot;NNFEM&quot;)
subplot(221)
visualize_scalar_on_scoped_body(domain.state[1:domain.nnodes], zeros(size(domain.state)...), domain)
subplot(222)
visualize_scalar_on_scoped_body(out[1:domain.nnodes], zeros(size(domain.state)...), domain)
subplot(223)
visualize_scalar_on_scoped_body(domain.state[domain.nnodes+1:end], zeros(size(domain.state)...), domain)
subplot(224)
visualize_scalar_on_scoped_body(out[domain.nnodes+1:end], zeros(size(domain.state)...), domain)</code></pre><p>Here shows the result for PoreFlow (left: PoreFlow, right: Exact)</p><p><img src="https://github.com/ADCMEMarket/ADCMEImages/blob/master/NNFEM/PoreFlow_static_linear.png?raw=true" alt/></p><p>Here shows the result for NNFEM (left: NNFEM, right: Exact)</p><p><img src="https://github.com/ADCMEMarket/ADCMEImages/blob/master/NNFEM/NNFEM_static_linear.png?raw=true" alt/></p><ul><li><p><a href="../api/#NNFEM.ExplicitSolverStep"><code>ExplicitSolverStep</code></a></p></li><li><p><a href="../api/#NNFEM.ImplicitStaticSolver"><code>ImplicitStaticSolver</code></a></p></li><li><p><a href="../api/#NNFEM.GeneralizedAlphaSolverStep"><code>GeneralizedAlphaSolverStep</code></a></p></li></ul><h2 id="AD-capable-Solvers-1"><a class="docs-heading-anchor" href="#AD-capable-Solvers-1">AD-capable Solvers</a><a class="docs-heading-anchor-permalink" href="#AD-capable-Solvers-1" title="Permalink"></a></h2><p>AD-capable solver are located in <code>src/adutils/solvers.jl</code>. These solvers are implemented with highly optimized C++ kernels. The usage of these solvers are different from AD-free solvers, where all data structures are wrapped in <code>domain</code> and <code>globaldata</code>. Here users need to provide variables such as displacement, velocity, acceleration, stress, strain, etc., explicitly to the solvers. To this end, the following utiltity functions are provided: </p><ul><li><p><a href="../api/#NNFEM.compute_boundary_info"><code>compute_boundary_info</code></a></p></li><li><p><a href="../api/#NNFEM.compute_external_force"><code>compute_external_force</code></a></p></li><li><p><a href="../api/#NNFEM.ExplicitSolverTime"><code>ExplicitSolverTime</code></a></p></li><li><p><a href="../api/#NNFEM.GeneralizedAlphaSolverTime"><code>GeneralizedAlphaSolverTime</code></a></p></li></ul><p>A list of available:</p><ul><li><a href="@ref"><code>LinearStaticSolver</code></a></li></ul><p>We consider the same linear elasticity problem problem used in AD-free solvers.</p><p>```julia\nusing NNFEM using PoreFlow using PyPlot </p><p>m = 40 n = 40 h = 1/m domain = example_domain(m, n, h) x, y = domain.nodes[:,1], domain.nodes[:,2] out = [@. x<em>y</em>(1-y)       @. x*(1-y)]</p><p>EBC = zeros(Int64,domain.nnodes, 2) g = [(@. x<em>y</em>(1-y)) (@. x*(1-y))] FBC = zeros(Int64,domain.nnodes,2) f = zeros(domain.nnodes,2)</p><p>for j = 1:n+1     EBC[(j-1)<em>(m+1)+m+1, :] .= -1     EBC[(j-1)</em>(m+1)+1, :] .= -1 end</p><p>for i = 1:m+1     EBC[n*(m+1)+i, :] .= -1     EBC[i, :] .= -1 end</p><p>nodes, elements = domain.nodes, domain.elements</p><p>domain = Domain(nodes, elements, 2, EBC, g, FBC, f) H = domain.elements[1].mat[1].H</p><p>EBC<em>func = nothing  FBC</em>func = nothing </p><p>function body<em>func(x, y, t)     f1 = @. -1.48148148148148x - 2.46913580246914     f2 = @. 2.46913580246914 - 4.93827160493827y     -[f1 f2] end globaldata = GlobalData(missing, missing, missing, missing, domain.neqs, EBC</em>func, FBC<em>func, body</em>func)</p><p>#––––––––––––––––––––––––-</p><h1>NNFEM Solver</h1><p>@info &quot;Solving using AD-free solver...&quot; globaldata, domain = LinearStaticSolver(globaldata, domain) figure(figsize=(10,10)) title(&quot;NNFEM&quot;) subplot(221) visualize<em>scalar</em>on<em>scoped</em>body(domain.state[1:domain.nnodes], zeros(size(domain.state)...), domain) subplot(222) visualize<em>scalar</em>on<em>scoped</em>body(out[1:domain.nnodes], zeros(size(domain.state)...), domain) subplot(223) visualize<em>scalar</em>on<em>scoped</em>body(domain.state[domain.nnodes+1:end], zeros(size(domain.state)...), domain) subplot(224) visualize<em>scalar</em>on<em>scoped</em>body(out[domain.nnodes+1:end], zeros(size(domain.state)...), domain)</p><p>@info &quot;Solving using AD-capable solver...&quot; domain = Domain(nodes, elements, 2, EBC, g, FBC, f) globaldata = GlobalData(missing, missing, missing, missing, domain.neqs, EBC<em>func, FBC</em>func, body<em>func) Fext = compute</em>external_force(globaldata, domain) d = LinearStaticSolver(globaldata, domain, domain.state, H, Fext) sess = Session(); init(sess) domain.state = run(sess, d)</p><p>figure(figsize=(10,10)) subplot(221) visualize<em>scalar</em>on<em>scoped</em>body(domain.state[1:domain.nnodes], zeros(size(domain.state)...), domain) subplot(222) visualize<em>scalar</em>on<em>scoped</em>body(out[1:domain.nnodes], zeros(size(domain.state)...), domain) subplot(223) visualize<em>scalar</em>on<em>scoped</em>body(domain.state[domain.nnodes+1:end], zeros(size(domain.state)...), domain) subplot(224) visualize<em>scalar</em>on<em>scoped</em>body(out[domain.nnodes+1:end], zeros(size(domain.state)...), domain)```</p><p><img src="https://github.com/ADCMEMarket/ADCMEImages/blob/master/NNFEM/AD_static_linear.png?raw=true" alt/></p><ul><li><p><a href="../api/#NNFEM.ExplicitSolver"><code>ExplicitSolver</code></a></p></li><li><p><a href="../api/#NNFEM.GeneralizedAlphaSolver"><code>GeneralizedAlphaSolver</code></a></p></li><li><p><a href="@ref"><code>ExplicitStaticSolver</code></a></p></li><li><p><a href="../api/#NNFEM.ImplicitStaticSolver"><code>ImplicitStaticSolver</code></a></p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../representation/">« Representations of Constitutive Relation</a><a class="docs-footer-nextpage" href="../gmsh/">Creating Mesh for FEM »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 1 June 2020 22:28">Monday 1 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
